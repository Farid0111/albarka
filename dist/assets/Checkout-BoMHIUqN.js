import{u as e,a as s,j as a,b as r}from"./index-CHmuOyXQ.js";import{e as n,r as t,L as l}from"./vendor-_hJ_S9AP.js";import{g as i}from"./price-zQCLA0EB.js";import"./firebase-DNEHJiPN.js";const c={name:"",phone:"",address:""};function o(){const o=n(),{getProductById:d}=e(),{cart:m,clearCart:p}=s(),[u,h]=t.useState(c),[j,x]=t.useState({}),[g,v]=t.useState(!1),[N,b]=t.useState(null),y=Object.keys(m).map(e=>{const s=d(e);if(!s)return null;const a=m[e],r=s.price,n=i(s.price);return{...s,qty:a,unitPrice:r,"priceBarré":n,subtotal:r*a}}).filter(Boolean),f=y.reduce((e,s)=>e+s.subtotal,0),k=0===y.length,C=(e,s)=>{h(a=>({...a,[e]:s})),j[e]&&x(s=>({...s,[e]:null}))};return k&&!g?a.jsxs("main",{style:{flex:1},children:[a.jsxs("section",{className:"page-title",children:[a.jsx("h1",{children:"Commander"}),a.jsx("p",{className:"cart-empty",children:"Votre panier est vide."})]}),a.jsx("section",{className:"checkout-section",style:{textAlign:"center"},children:a.jsx(l,{to:"/produits",className:"btn btn-primary",children:"Voir les produits"})})]}):g?a.jsx("main",{style:{flex:1},children:a.jsxs("section",{className:"page-title checkout-success",children:[a.jsx("h1",{children:"Commande enregistrée"}),a.jsx("p",{children:"Merci ! Nous vous contacterons pour confirmer la livraison. Vous réglerez le montant à la livraison."}),a.jsx(l,{to:"/",className:"btn btn-primary",children:"Retour à l'accueil"})]})}):a.jsxs("main",{style:{flex:1},children:[a.jsxs("section",{className:"page-title",children:[a.jsx("h1",{children:"Finaliser la commande"}),a.jsx("p",{className:"text-muted",children:"Paiement à la livraison — Renseignez vos coordonnées de livraison."})]}),a.jsxs("section",{className:"checkout-section",children:[a.jsxs("div",{className:"checkout-notice",children:[a.jsx("strong",{children:"Paiement à la livraison"}),a.jsx("p",{children:"Vous réglerez le montant de votre commande en espèces à la livraison. Aucun paiement en ligne."})]}),a.jsxs("form",{className:"checkout-form",onSubmit:async e=>{if(e.preventDefault(),!k&&(()=>{var e,s,a;const r={};return(null==(e=u.name)?void 0:e.trim())||(r.name="Obligatoire"),(null==(s=u.phone)?void 0:s.trim())||(r.phone="Obligatoire"),(null==(a=u.address)?void 0:a.trim())||(r.address="Obligatoire"),x(r),0===Object.keys(r).length})()){b(null);try{await r({name:u.name,phone:u.phone,address:u.address,items:y.map(e=>({id:e.id,name:e.name,emoji:e.emoji,qty:e.qty,price:e.unitPrice,subtotal:e.subtotal})),total:f}),v(!0),p(),setTimeout(()=>o("/"),4e3)}catch(s){b(s.message||"Erreur lors de l'enregistrement de la commande.")}}},children:[a.jsxs("label",{children:["Nom complet *",a.jsx("input",{type:"text",value:u.name,onChange:e=>C("name",e.target.value),placeholder:"Votre nom",className:j.name?"input-error":""}),j.name&&a.jsx("span",{className:"field-error",children:j.name})]}),a.jsxs("label",{children:["Téléphone *",a.jsx("input",{type:"tel",value:u.phone,onChange:e=>C("phone",e.target.value),placeholder:"96 12 34 56",className:j.phone?"input-error":""}),j.phone&&a.jsx("span",{className:"field-error",children:j.phone})]}),a.jsxs("label",{children:["Adresse de livraison *",a.jsx("input",{type:"text",value:u.address,onChange:e=>C("address",e.target.value),placeholder:"Quartier, rue, ville",className:j.address?"input-error":""}),j.address&&a.jsx("span",{className:"field-error",children:j.address})]}),a.jsxs("div",{className:"checkout-recap",children:[a.jsx("h3",{children:"Récapitulatif"}),a.jsx("ul",{children:y.map(e=>a.jsxs("li",{children:[e.emoji," ",e.name," × ",e.qty," — ",a.jsxs("span",{className:"price-strike",children:[e.priceBarré*e.qty," FCFA"]})," ",a.jsxs("span",{className:"price-current",children:[e.subtotal," FCFA"]})]},e.id))}),a.jsx("p",{className:"checkout-total",children:a.jsxs("strong",{children:["Total : ",a.jsxs("span",{className:"price-current",children:[f," FCFA"]})]})}),a.jsx("p",{className:"checkout-payment-note",children:"À régler à la livraison."})]}),N&&a.jsx("p",{className:"field-error",children:N}),a.jsx("button",{type:"submit",className:"btn btn-primary btn-block",children:"Confirmer la commande"})]})]})]})}export{o as default};
