import{u as e,a as s,g as r,j as t,b as i}from"./index-BLVL_dHp.js";import{d as n,r as a,L as l}from"./vendor-CWxX1f16.js";import{g as c}from"./price-zQCLA0EB.js";import"./firebase-DoqP6OWA.js";const o={name:"",phone:"",address:""};function d(e){const s=e%60;return`${Math.floor(e/60).toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`}function m(){const{id:m}=n(),{products:p,loading:u,getProductById:h}=e(),g=h(m),{cart:x,setCartQuantity:j,clearCart:b}=s(),[f,v]=a.useState([]),[N,y]=a.useState(!0),[w,k]=a.useState(1800),[C,D]=a.useState(!1);a.useEffect(()=>{window.scrollTo(0,0)},[m]),a.useEffect(()=>{g?.id&&(k(1800),D(!1))},[g?.id]);const A=e=>"string"==typeof e?e:e?.url??e?.imageUrl??e?.image??e?.src,S=e=>e&&"string"==typeof e,F=(()=>{const e=g?.image??g?.images??g?.imageUrl??g?.photo;if(!e)return[];return(Array.isArray(e)?e:[e]).map(A).filter(S)})(),q=F[0],[E,$]=a.useState(!1),[O,I]=a.useState(o),[M,P]=a.useState({}),[R,_]=a.useState(!1),[z,B]=a.useState(null),H=a.useRef(null),L=a.useRef(null),[T,Q]=a.useState(!0),[V,W]=a.useState(!1),[U,X]=a.useState(1);if(a.useEffect(()=>{const e=H.current;if(!e)return;if("IntersectionObserver"in window){const s=new IntersectionObserver(([e])=>{const s=e.boundingClientRect,r=window.innerHeight||document.documentElement.clientHeight||0,t=s.top>=r,i=s.bottom<=0;Q(!(t||i))});return s.observe(e),()=>s.disconnect()}const s=()=>{Q((()=>{const s=e.getBoundingClientRect(),r=window.innerHeight||document.documentElement.clientHeight||0,t=s.top>=r,i=s.bottom<=0;return!(t||i)})())};return s(),window.addEventListener("scroll",s),()=>window.removeEventListener("scroll",s)},[g?.id]),a.useEffect(()=>{E&&V&&L.current&&(L.current.scrollIntoView({behavior:"smooth",block:"start"}),W(!1))},[E,V]),a.useEffect(()=>{if(!g?.id)return y(!1),void v([]);const e=g.reviews;if(Array.isArray(e)&&e.length>0){const s=e.map(A).filter(S);return v(s),void y(!1)}y(!0),r(g.id).then(v).catch(()=>v([])).finally(()=>y(!1))},[g?.id,g?.reviews]),a.useEffect(()=>{if(!g||C)return;const e=setInterval(()=>{k(e=>e<=1?(D(!0),0):e-1)},1e3);return()=>clearInterval(e)},[g?.id,C]),u&&!g)return t.jsx("main",{style:{flex:1},className:"page-title",children:t.jsx("p",{className:"products-loading",children:"Chargement du produitâ€¦"})});if(!g)return t.jsxs("main",{style:{flex:1},className:"page-title",children:[t.jsx("h1",{children:"Produit introuvable"}),t.jsx(l,{to:"/produits",className:"btn btn-primary",children:"Retour au catalogue"})]});const G=()=>{j(g.id,U),$(!0)},J=(e,s)=>{I(r=>({...r,[e]:s})),M[e]&&P(s=>({...s,[e]:null}))},K=x[g.id]||U,Y=g.price,Z=Y*(E?K:U),ee=c(g.price);return t.jsxs("main",{style:{flex:1},children:[t.jsxs("section",{className:"product-detail",children:[t.jsxs("div",{className:"product-detail-main",children:[t.jsx("div",{className:"product-detail-image-wrap",children:t.jsx("div",{className:"product-detail-image",children:q?t.jsxs(t.Fragment,{children:[t.jsx("img",{src:q,alt:g.name,className:"product-detail-image-img"}),F.length>1&&t.jsx("div",{className:"product-detail-image-thumbnails",children:F.map((e,s)=>t.jsx("img",{src:e,alt:`${g.name} ${s+1}`,className:"product-detail-thumb",loading:"lazy"},`${e}-${s}`))})]}):t.jsx("span",{className:"product-detail-emoji",children:g.emoji||"ðŸ“¦"})})}),t.jsxs("div",{className:"product-detail-info",children:[t.jsx("h1",{children:g.name}),t.jsxs("p",{className:"product-detail-price",children:[t.jsxs("span",{className:"price-strike",children:[ee," FCFA"]}),t.jsxs("span",{className:"price-current",children:[Y," FCFA"]})]}),t.jsxs("div",{className:"product-detail-qty",children:[t.jsx("label",{htmlFor:"product-qty",children:"QuantitÃ© :"}),t.jsxs("div",{className:"qty-selector",children:[t.jsx("button",{type:"button",className:"qty-btn",onClick:()=>X(e=>Math.max(1,e-1)),"aria-label":"Diminuer",children:"âˆ’"}),t.jsx("input",{id:"product-qty",type:"number",min:1,max:99,value:U,onChange:e=>X(Math.max(1,Math.min(99,Number(e.target.value)||1))),className:"qty-input"}),t.jsx("button",{type:"button",className:"qty-btn",onClick:()=>X(e=>Math.min(99,e+1)),"aria-label":"Augmenter",children:"+"})]})]}),t.jsx("div",{className:"product-detail-pay",ref:H,children:C?t.jsx("p",{className:"product-detail-timer-expired",children:"Le dÃ©lai pour cette offre est Ã©coulÃ©. Ajoutez au panier pour commander."}):t.jsxs(t.Fragment,{children:[t.jsxs("p",{className:"product-detail-timer",children:["Offre valable encore ",t.jsx("span",{className:"timer-value",children:d(w)})]}),t.jsxs("button",{type:"button",className:"btn btn-primary btn-pay",onClick:G,children:["Commander â€” ",Y*U," FCFA"]})]})}),E&&t.jsxs("div",{className:"product-order-form-wrap",ref:L,children:[t.jsxs("div",{className:"checkout-notice",children:[t.jsx("strong",{children:"Paiement Ã  la livraison"}),t.jsx("p",{children:"Vous rÃ©glerez le montant en espÃ¨ces Ã  la livraison."})]}),t.jsxs("form",{className:"checkout-form product-order-form",onSubmit:async e=>{if(e.preventDefault(),!(()=>{const e={};return O.name?.trim()||(e.name="Obligatoire"),O.phone?.trim()||(e.phone="Obligatoire"),O.address?.trim()||(e.address="Obligatoire"),P(e),0===Object.keys(e).length})())return;B(null);const s=x[g.id]||U,r=g.price,t=[{id:g.id,name:g.name,emoji:g.emoji,qty:s,price:r,subtotal:r*s}];try{await i({name:O.name,phone:O.phone,address:O.address,items:t,total:r*s}),window.fbq&&window.fbq("track","Purchase",{value:r*s,currency:"XOF",content_name:g.name,content_ids:[g.id],content_type:"product",num_items:s}),_(!0),b()}catch(n){B(n.message||"Erreur lors de l'enregistrement.")}},children:[t.jsxs("label",{children:["Nom complet *",t.jsx("input",{type:"text",value:O.name,onChange:e=>J("name",e.target.value),placeholder:"Votre nom",className:M.name?"input-error":""}),M.name&&t.jsx("span",{className:"field-error",children:M.name})]}),t.jsxs("label",{children:["TÃ©lÃ©phone *",t.jsx("input",{type:"tel",value:O.phone,onChange:e=>J("phone",e.target.value),placeholder:"96 12 34 56",className:M.phone?"input-error":""}),M.phone&&t.jsx("span",{className:"field-error",children:M.phone})]}),t.jsxs("label",{children:["Adresse de livraison *",t.jsx("input",{type:"text",value:O.address,onChange:e=>J("address",e.target.value),placeholder:"Quartier, rue, ville",className:M.address?"input-error":""}),M.address&&t.jsx("span",{className:"field-error",children:M.address})]}),t.jsx("div",{className:"checkout-recap",children:t.jsxs("p",{className:"checkout-total",children:[t.jsxs("strong",{children:["Total : ",Z," FCFA"]})," â€” Ã€ rÃ©gler Ã  la livraison."]})}),z&&t.jsx("p",{className:"field-error",children:z}),t.jsx("button",{type:"submit",className:"btn btn-primary btn-block",children:R?"Commande enregistrÃ©e !":"Confirmer la commande"})]})]}),R&&t.jsxs("div",{className:"product-order-success",children:[t.jsxs("p",{children:[t.jsx("strong",{children:"Merci !"})," Nous vous contacterons pour confirmer la livraison."]}),t.jsx(l,{to:"/",className:"btn btn-primary",children:"Retour Ã  l'accueil"})]})]})]}),g.description&&t.jsx("p",{className:"product-detail-desc product-detail-desc-below",children:g.description}),g.longDescription&&t.jsxs("section",{className:"product-long-description",id:"fiche-produit",children:[t.jsx("h2",{children:"DÃ©tails produit"}),g.longDescription.intro&&t.jsx("p",{className:"product-desc-intro",children:g.longDescription.intro}),g.longDescription.description&&t.jsxs("div",{className:"product-desc-block",children:[t.jsx("h3",{children:"PrÃ©sentation"}),t.jsx("p",{children:g.longDescription.description})]}),g.longDescription.ingredients&&t.jsxs("div",{className:"product-desc-block",children:[t.jsx("h3",{children:"IngrÃ©dients"}),t.jsx("p",{children:g.longDescription.ingredients})]}),g.longDescription.preparation&&t.jsxs("div",{className:"product-desc-block",children:[t.jsx("h3",{children:"PrÃ©paration / Mode d'emploi"}),t.jsx("p",{children:g.longDescription.preparation})]}),g.longDescription.benefits&&g.longDescription.benefits.length>0&&t.jsxs("div",{className:"product-desc-block",children:[t.jsx("h3",{children:"Bienfaits"}),t.jsx("ul",{children:g.longDescription.benefits.map((e,s)=>t.jsx("li",{children:e},s))})]}),g.longDescription.storage&&t.jsxs("div",{className:"product-desc-block",children:[t.jsx("h3",{children:"Conservation"}),t.jsx("p",{children:g.longDescription.storage})]}),g.longDescription.format&&t.jsxs("div",{className:"product-desc-block product-desc-format",children:[t.jsx("h3",{children:"Contenu"}),t.jsx("p",{children:g.longDescription.format})]})]}),t.jsx("a",{href:"https://wa.me/62434644?text=Bonjour%20je%20viens%20suite%20Ã %20votre%20publicitÃ©%20Facebook%20pour%20le%20thÃ©%20Albarka",target:"_blank",rel:"noopener noreferrer",onClick:()=>{window.fbq&&window.fbq("trackCustom","WhatsAppClick")},style:{display:"block",marginTop:"10px",backgroundColor:"#25D366",color:"#fff",textAlign:"center",padding:"12px",borderRadius:"6px",textDecoration:"none",fontWeight:"bold"},children:"ðŸ’¬ Parler Ã  un assistant sur WhatsApp"}),t.jsxs("section",{className:"product-reviews product-reviews-large",id:"avis-clients",children:[t.jsx("h2",{className:"product-reviews-title",children:"Avis des utilisateurs"}),t.jsx("p",{className:"product-reviews-subtitle",children:"Ce que disent les clients sur ce produit."}),N?t.jsx("p",{className:"review-images-loading",children:"Chargement des avisâ€¦"}):0===f.length?t.jsx("p",{className:"no-reviews",children:"Aucun avis en image pour ce produit."}):t.jsx("div",{className:"review-images-gallery review-images-gallery-large","aria-label":"Avis des utilisateurs en images",children:f.map((e,s)=>t.jsx("article",{className:"review-image-card",children:t.jsx("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"review-image-link-large",children:t.jsx("img",{src:e,alt:`Avis client ${s+1}`,className:"review-image-large",loading:"lazy"})})},`${e}-${s}`))})]})]}),!C&&!E&&!R&&!T&&t.jsx("div",{className:"product-detail-commander-bar","aria-hidden":"true",children:t.jsxs("button",{type:"button",className:"btn btn-primary btn-pay btn-block",onClick:()=>{W(!0),G()},children:["Commander â€” ",Y*U," FCFA"]})})]})}export{m as default};
